!function(){"use strict";const e=new URLSearchParams(window.location.search),t="preview"===e.get("spin_wheel")&&!!e.get("campaign_id"),i=((window.USPIN_WHEEL_UI_CONFIG?.settings?.post_title||"").toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,""),(window.USPIN_WHEEL_UI_CONFIG?.settings?.post_id?window.USPIN_WHEEL_UI_CONFIG.settings.post_id:"")+"_uspw_"),s={exist:!1,$sel:null,$wheelWrap:null,$wheel:null,$area:null,$start:null,count:0,skewVal:0,rotateVal:0,spinDegrees:0,spinDuration:0,click:0,timer:null,init:function(e){return this.exist?(this.$wheelWrap.querySelector(".win").classList.remove("active"),this):(this.$sel=document.querySelector(e),this.$wheelWrap=this.$sel.querySelector(".wheelWrap"),this.$wheel=this.$wheelWrap.querySelector(".wheel"),this.$area=this.$wheel.querySelectorAll(".area"),this.$start=this.$wheelWrap.querySelector(".start"),this.count=this.$area.length,this.skewVal=90-360/this.count,this.rotateVal=360/this.count/2,this.spinDegrees=360*parseInt(this.$wheel.getAttribute("data-spin-circles")),this.spinDuration=parseFloat(this.$wheel.getAttribute("data-spin-speed")),this.click=0,this.$sel.classList.add("visible"),this.$wheel.style.transitionDuration=this.spinDuration+"s",this.$area.forEach((e,t)=>{e.style.transform="rotate("+360/this.count*t+"deg) skewY(-"+this.skewVal+"deg)";var i=e.querySelector("span");i.style.background=e.getAttribute("data-wheel-bg"),i.style.transform="skewY("+this.skewVal+"deg) rotate("+this.rotateVal+"deg)"}),this.$start.addEventListener("click",()=>{if(this.click>0)return console.warn("Spin Wheel: Wheel already spinning"),!1;if(1==USPIN_WHEEL_UI_CONFIG?.settings?.collect_email){document.querySelector(".sc-form-wrap").classList.add("active");let e=this.$wheelWrap.querySelector(".sc-spin-form");e.addEventListener("submit",t=>{t.preventDefault();let i=e.querySelector('input[name="email"]').value,s=e.querySelector('input[name="name"]').value;i&&(localStorage.setItem("ultimate_spin_wheel_email",i),console.log("Spin Wheel: Email collected:",i)),s&&(localStorage.setItem("ultimate_spin_wheel_name",s),console.log("Spin Wheel: Name collected:",s)),document.querySelector(".sc-form-wrap").classList.remove("active"),this.spin()})}else this.spin()}),this.exist=!0,this)},spin:function(){if(!this.exist)return console.warn("Spin Wheel: Wheel not initialized"),!1;this.click++,clearTimeout(this.timer);let e=[],t=0;this.$area.forEach((i,s)=>{let n=parseFloat(i.getAttribute("data-probability"))||0,o="wins"===i.getAttribute("data-wheel-prize");o?0===n&&(n=0):n=1,t+=n,e.push({index:s,prob:n,isWin:o,element:i})}),e.forEach(e=>{e.normalizedProb=e.prob/t*100});let i=100*Math.random(),s=0,n=0;for(let t=0;t<e.length;t++)if(s+=e[t].normalizedProb,i<=s){n=e[t].index;break}this.selectedWinnerIndex=n;let o=360/this.count,l=n*o+o/2,r=this.spinDegrees*this.click+(360-l);return this.$wheel.style.transform="rotate("+r+"deg)",this.timer=setTimeout(()=>{this.handleSpinResult()},1e3*this.spinDuration+200),console.log("Spin Wheel: Spinning to index",n,"with probability",e[n].normalizedProb.toFixed(2)+"%"),!0},handleSpinResult:function(){let e=this.$area[this.selectedWinnerIndex],i=this.$wheelWrap.querySelector(".msg");if("wins"===e.getAttribute("data-wheel-prize")){i.classList.add("active"),i.setAttribute("data-status","won");let n=e.getAttribute("data-coupon-code")||"";if(n=this.decryptCoupon(n),t&&(n="TEST-CODE-123"),n){console.log("Coupon Code:",n),document.querySelector(".sc-coupon-code").textContent=n;document.querySelector(".sc-coupon").addEventListener("click",function(){const e=document.querySelector(".sc-coupon-code"),t=e.textContent;navigator.clipboard.writeText(n).then(()=>{e.textContent="Copied",setTimeout(()=>{e.textContent=t},2e3)}).catch(e=>{console.error("Failed to copy coupon code:",e)})})}let o=window.design?.prizeWonMsg?.text||"You won a {{discount_label}} discount!",l=e.getAttribute("data-wheel-message")||"";o=o.replace("{{discount_label}}",l),i.querySelector(".prizeMsg").innerHTML=o;let r={email:localStorage.getItem("ultimate_spin_wheel_email")||"",name:localStorage.getItem("ultimate_spin_wheel_name")||"",coupon_title:e.getAttribute("data-wheel-message"),coupon_code:n||"",status:"won",post_id:USPIN_WHEEL_UI_CONFIG?.settings?.post_id||0};s.spinWheelSpinned(r)}else{i.setAttribute("data-status","lost"),i.classList.add("active");const e=i.querySelector(".title");e&&(e.innerHTML="<span>Better luck next time!</span>");const t=i.querySelector(".sc-coupon");t&&(t.textContent="Try Again");let n={email:localStorage.getItem("ultimate_spin_wheel_email")||"",name:localStorage.getItem("ultimate_spin_wheel_name")||"",coupon_title:"",coupon_code:"",status:"lost",post_id:USPIN_WHEEL_UI_CONFIG?.settings?.post_id||0};s.spinWheelSpinned(n)}},decryptCoupon:function(e){const t=atob(e),[i,s]=t.split("|");return i},spinWheelSpinned:function(e){console.log("Spin Wheel: Spin wheel has been spun by the user"),this.storeCloseTime("system");const t=new XMLHttpRequest;t.open("POST",USPIN_WHEEL_UI_CONFIG?.ajax_url||"",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");const i=new URLSearchParams({action:"ultimate_spin_wheel_spinned",name:e.name,email:e.email,campaign_id:USPIN_WHEEL_UI_CONFIG?.settings?.post_id||"",campaign_title:USPIN_WHEEL_UI_CONFIG?.settings?.post_title||"",coupon_title:e.coupon_title,coupon_code:e.coupon_code,status:e.status,nonce:USPIN_WHEEL_UI_CONFIG?.nonce||""}).toString();t.onload=function(){t.status>=200&&t.status<300?console.log("Spin Wheel: Spin wheel spinned response:",t.responseText):console.error("Spin Wheel: Error spinning wheel:",t.statusText)},t.onerror=function(){console.error("Spin Wheel: Error spinning wheel:",t.statusText)},t.send(i)},storeCloseTime:function(e="button"){if("demo.wowdevs.com"===window.location.hostname)return void console.info("Spin Wheel: Close time not stored in demo environment.");const t={button:216e5,system:6048e5,default:216e5},s=t[e]||t.default,n=Date.now()+s;localStorage.setItem(i+"__close_time",n.toString()),localStorage.setItem(i+"__close_reason",e),localStorage.setItem(i+"__close_count",(parseInt(localStorage.getItem(i+"__close_count")||"0")+1).toString()),console.info(`Spin Wheel: Spin wheel close time stored for ${"button"===e?"6 hours":"7 days"} (reason: ${e})`)}};window.USPW_UI_CONFIG=s}(jQuery),function(e){"use strict";const t=new URLSearchParams(window.location.search),i="preview"===t.get("spin_wheel")&&!!t.get("campaign_id"),s=(window.USPIN_WHEEL_UI_CONFIG?.settings?.post_id?window.USPIN_WHEEL_UI_CONFIG.settings.post_id:"")+"_uspw_",n={config:null,isInitialized:!1,isDisplayed:!1,timers:{},collectEmail:null,init:function(){if(!this.isInitialized)if(this.config=window.USPIN_WHEEL_UI_CONFIG||{},this.config.settings){if(this.collectEmail=this.config.settings.collect_email||!0,i)return this.displaySpinWheel("preview"),this.isInitialized=!0,void console.log("Spin Wheel: Preview mode active, wheel shown unconditionally.");this.isSpinWheelClosedClick()?console.log("Spin Wheel: Spin wheel is closed until",this.getCloseTime()):(this.isInitialized=!0,console.log("Spin Wheel initialized with triggers:"),this.displaySpinWheel("init"))}else console.warn("Spin Wheel: No settings found")},storeCloseTime:function(e="button"){let t=parseInt(this.config?.settings?.display_frequency?.custom_days)||7;const i=t>0?t:7,n={button:216e5,system:24*i*60*60*1e3,default:216e5},o=n[e]||n.default,l=Date.now()+o;localStorage.setItem(s+"__close_time",l.toString()),localStorage.setItem(s+"__close_reason",e),localStorage.setItem(s+"__close_count",(parseInt(localStorage.getItem(s+"__close_count")||"0")+1).toString()),console.info(`Spin Wheel: Spin wheel close time stored for ${"button"===e?"6 hours":i+" days"} (reason: ${e})`)},getCloseTime:function(){const e=localStorage.getItem(s+"__close_time"),t=parseInt(e);return isNaN(t)?null:new Date(t)},getCloseReason:function(){return localStorage.getItem(s+"__close_reason")||null},getCloseCount:function(){return parseInt(localStorage.getItem(s+"__close_count")||"0")},isSpinWheelClosedClick:function(){const e=this.getCloseTime();return!!e&&new Date<e},isSpinWheelSystemClosed:function(){const e=this.getCloseTime();if(!e)return!1;return new Date<e&&"system"===this.getCloseReason()},setupTriggers:function(){const e=this.config.settings.triggers_setup||{};this.isDeviceCompatible(e.target_devices)?this.isSpinWheelClosedClick()?console.log("Spin Wheel: Spin wheel is closed until",this.getCloseTime()):this.triggers.forEach(t=>{switch(t){case"referrer":this.setupReferrerTrigger(e.referrer_domains);break;case"page_views":this.setupPageViewsTrigger(e.page_views_count)}}):console.log("Spin Wheel: Device not compatible")},isDeviceCompatible:function(e){if(!e||e.includes("all"))return!0;const t=this.getDeviceType();return e.includes(t)},getDeviceType:function(){const e=window.innerWidth;return e<=768?"mobile":e<=1024?"tablet":"desktop"},setupReferrerTrigger:function(e=[]){if(!e||0===e.length)return;const t=document.referrer;if(!t)return;const i=new URL(t).hostname;e.some(e=>i.includes(e)||e.includes(i))&&!this.isDisplayed&&(console.log(`Spin Wheel: Referrer trigger activated from ${i}`),this.displaySpinWheel("referrer"))},setupPageViewsTrigger:function(e=3){const t=s+"__page_views";let i=parseInt(localStorage.getItem(t)||"0")+1;localStorage.setItem(t,i.toString()),i>=e&&!this.isDisplayed&&(console.log(`Spin Wheel: Page views trigger activated (${i} views)`),this.displaySpinWheel("page_views"))},displaySpinWheel:function(t){if(this.isDisplayed)return;this.isDisplayed=!0,console.log(`Spin Wheel: Displaying spin wheel (triggered by: ${t})`);const i=this.config.settings||{};console.log(i.popup_settings),e(".spinWheel").SlickModals({...i.popup_settings,callback_afterVisible:function(){var e;e=".spinWheel",USPW_UI_CONFIG.init(e)},callback_afterHidden:function(){console.log("Spin Wheel: Spin wheel closed"),n.storeCloseTime("button")}}),this.trackTrigger(t)},trackTrigger:function(e){const t={trigger:e,timestamp:Date.now(),post_id:this.config.settings.post_id,user_ip:this.config.settings.user_ip};console.log("Spin Wheel: Trigger tracked:",t)},throttle:function(e,t){let i;return function(){const s=arguments,n=this;i||(e.apply(n,s),i=!0,setTimeout(()=>i=!1,t))}},spinWheelSpinned:function(e){console.log("Spin Wheel: Spin wheel has been spun by the user"),this.storeCloseTime("system");const t=new XMLHttpRequest;t.open("POST",USPIN_WHEEL_UI_CONFIG?.ajax_url||"",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");const i=new URLSearchParams({action:"ultimate_spin_wheel_spinned",name:e.name,email:e.email,campaign_id:USPIN_WHEEL_UI_CONFIG?.settings?.post_id||"",campaign_title:USPIN_WHEEL_UI_CONFIG?.settings?.post_title||"",coupon_title:e.coupon_title,coupon_code:e.coupon_code,status:e.status,nonce:USPIN_WHEEL_UI_CONFIG?.nonce||""}).toString();t.onload=function(){t.status>=200&&t.status<300?console.log("Spin Wheel: Spin wheel spinned response:",t.responseText):console.error("Spin Wheel: Error spinning wheel:",t.statusText)},t.onerror=function(){console.error("Spin Wheel: Error spinning wheel:",t.statusText)},t.send(i)}};window.addEventListener("load",function(e){n.init()})}(jQuery);