"use strict";(globalThis.webpackChunkultimate_spin_wheel=globalThis.webpackChunkultimate_spin_wheel||[]).push([[520],{520:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var r=a(609),l=a(83),n=a(723);const s=()=>{const[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[o,m]=(0,r.useState)(1),[d,u]=(0,r.useState)(1),[p,h]=(0,r.useState)(0),[g]=(0,r.useState)(20),[x,y]=(0,r.useState)(""),[f,w]=(0,r.useState)([]),[_,b]=(0,r.useState)(!1),N=async(e,t={})=>{const a=new URLSearchParams({action:e,nonce:USPIN_CONFIG_ADMIN.nonce,...t});Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(a.delete(e),t[e].forEach(t=>a.append(`${e}[]`,t)))});const r=await l.A.post(USPIN_CONFIG_ADMIN.ajax_url,a);if(!r.data.success)throw new Error(r.data?.data?.message||"Ajax request failed");return r.data.data},E=async(e=1,a="",r=!1)=>{s(!0),c(null);try{const l=await N("ultimate_spin_wheel_get_entries",{page:e,per_page:g,search:a,clear_cache:r?"true":"false",nonce:USPIN_CONFIG_ADMIN.nonce});t(l.entries||[]),u(l.total_pages||1),h(l.total||0)}catch(e){c(e.message||"Failed to fetch entries"),console.error("Error fetching entries:",e)}finally{s(!1)}};(0,r.useEffect)(()=>{E(o,x)},[o,x]);const v=e=>{m(e)},k=e=>{try{return JSON.parse(e||"{}")}catch(e){return{}}};return(0,r.createElement)("div",{className:"space-y-6"},(0,r.createElement)("div",{className:"bg-white rounded-xl shadow-lg p-6"},(0,r.createElement)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center"},(0,r.createElement)("div",{className:"flex flex-col md:flex-row gap-4 flex-1"},(0,r.createElement)("div",{className:"flex-1 max-w-md"},(0,r.createElement)("input",{type:"text",placeholder:(0,n.__)("Search entries...","ultimate-spin-wheel"),value:x,onChange:e=>{y(e.target.value),m(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}))),(0,r.createElement)("div",{className:"flex gap-2"},(0,r.createElement)("button",{onClick:async()=>{b(!0);try{await E(o,x,!0);const e=document.title;document.title=(0,n.__)("Cache Refreshed!","ultimate-spin-wheel"),setTimeout(()=>{document.title=e},2e3)}catch(e){console.error("Error refreshing cache:",e),alert((0,n.__)("Failed to refresh cache. Please try again.","ultimate-spin-wheel"))}finally{b(!1)}},disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},(0,r.createElement)("svg",{className:"w-4 h-4 "+(_?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,r.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})),_?(0,n.__)("Refreshing...","ultimate-spin-wheel"):(0,n.__)("Refresh Cache","ultimate-spin-wheel")),(0,r.createElement)("button",{onClick:async()=>{try{const e=await N("ultimate_spin_wheel_export_entries",{search:x,nonce:USPIN_CONFIG_ADMIN.nonce}),t="string"==typeof e?e:"";if(!t||!t.trim().startsWith("ID,"))throw new Error("No valid CSV content received from server");const a=new Blob(["\ufeff"+t],{type:"text/csv;charset=utf-8;"}),r=window.URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=`qr-entries-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r),alert((0,n.__)("Entries exported successfully!","ultimate-spin-wheel"))}catch(e){console.error("Error exporting entries:",e),alert((0,n.__)("Failed to export entries. Please try again.","ultimate-spin-wheel"))}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"},(0,n.__)("Export CSV","ultimate-spin-wheel")),f.length>0&&(0,r.createElement)("button",{onClick:async()=>{if(0!==f.length){if(window.confirm((0,n.__)(`Are you sure you want to delete ${f.length} entries?`,"ultimate-spin-wheel")))try{await N("ultimate_spin_wheel_bulk_delete_entries",{ids:f,nonce:USPIN_CONFIG_ADMIN.nonce}),w([]),E(o,x)}catch(e){console.error("Error bulk deleting entries:",e),alert((0,n.__)("Failed to delete entries. Please try again.","ultimate-spin-wheel"))}}else alert((0,n.__)("Please select entries to delete.","ultimate-spin-wheel"))},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors"},(0,n.__)("Delete Selected","ultimate-spin-wheel")," (",f.length,")"))),(0,r.createElement)("div",{className:"mt-4 flex justify-between items-center"},(0,r.createElement)("div",{className:"text-sm text-gray-600"},(0,n.__)("Total entries:","ultimate-spin-wheel")," ",p),(0,r.createElement)("div",{className:"text-xs text-gray-500 flex items-center gap-1"},(0,r.createElement)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,r.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})),(0,n.__)("Data cached for 60 minutes","ultimate-spin-wheel")))),(0,r.createElement)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden"},a?(0,r.createElement)("div",{className:"p-12 text-center"},(0,r.createElement)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,r.createElement)("p",{className:"mt-4 text-gray-600"},(0,n.__)("Loading entries...","ultimate-spin-wheel"))):i?(0,r.createElement)("div",{className:"p-8 text-center"},(0,r.createElement)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6"},(0,r.createElement)("svg",{className:"w-12 h-12 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,r.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})),(0,r.createElement)("p",{className:"text-red-600 font-medium"},i),(0,r.createElement)("button",{onClick:()=>E(o,x),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"},(0,n.__)("Retry","ultimate-spin-wheel")))):(0,r.createElement)("div",{className:"overflow-x-auto"},(0,r.createElement)("table",{className:"w-full"},(0,r.createElement)("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200"},(0,r.createElement)("tr",null,(0,r.createElement)("th",{scope:"col",className:"px-6 py-4 text-left"},(0,r.createElement)("input",{type:"checkbox",checked:f.length===e.length&&e.length>0,onChange:()=>{f.length===e.length?w([]):w(e.map(e=>e.id))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})),(0,r.createElement)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Name","ultimate-spin-wheel")),(0,r.createElement)("th",{scope:"col",className:"px-3 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Email","ultimate-spin-wheel")),(0,r.createElement)("th",{scope:"col",className:"px-3 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Campaign","ultimate-spin-wheel")),(0,r.createElement)("th",{scope:"col",className:"px-3 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Type","ultimate-spin-wheel")),(0,r.createElement)("th",{scope:"col",className:"px-3 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Created","ultimate-spin-wheel")),(0,r.createElement)("th",{scope:"col",className:"px-3 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider"},(0,n.__)("Actions","ultimate-spin-wheel")))),(0,r.createElement)("tbody",{className:"divide-y divide-gray-200"},e&&e.length>0?e.map(e=>{return k(e.others_data),k(e.user_data),(0,r.createElement)("tr",{key:e.id,className:"hover:bg-gray-50"},(0,r.createElement)("td",{className:"px-6 py-4"},(0,r.createElement)("input",{type:"checkbox",checked:f.includes(e.id),onChange:()=>{return t=e.id,void w(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})),(0,r.createElement)("td",{className:"px-6 py-4"},(0,r.createElement)("div",{className:"font-medium text-gray-900 text-sm"},e.name||"-"),(0,r.createElement)("div",{className:"text-xs text-gray-500"},"ID: #",e.id)),(0,r.createElement)("td",{className:"px-3 py-4 text-sm text-gray-600"},e.email||"-"),(0,r.createElement)("td",{className:"px-3 py-4 text-sm text-gray-600"},(0,r.createElement)("div",{className:"font-medium"},e.campaign_title||"-"),e.campaign_id&&(0,r.createElement)("div",{className:"text-xs text-gray-500"},"ID: #",e.campaign_id)),(0,r.createElement)("td",{className:"px-3 py-4 text-sm text-gray-600"},(0,r.createElement)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},e.campaign_type||"QR Code")),(0,r.createElement)("td",{className:"px-3 py-4 text-sm text-gray-600"},(t=e.created_at)?new Date(t).toLocaleString():"-"),(0,r.createElement)("td",{className:"px-3 py-4 text-sm"},(0,r.createElement)("div",{className:"flex items-center gap-2"},(0,r.createElement)("button",{onClick:()=>(async e=>{if(window.confirm((0,n.__)("Are you sure you want to delete this entry?","ultimate-spin-wheel")))try{await N("ultimate_spin_wheel_delete_entry",{id:e,nonce:USPIN_CONFIG_ADMIN.nonce}),E(o,x)}catch(e){console.error("Error deleting entry:",e),alert((0,n.__)("Failed to delete entry. Please try again.","ultimate-spin-wheel"))}})(e.id),className:"text-red-600 hover:text-red-700 p-1 rounded-full hover:bg-red-50 transition-colors",title:(0,n.__)("Delete Entry","ultimate-spin-wheel")},(0,r.createElement)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,r.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}))))));var t}):(0,r.createElement)("tr",null,(0,r.createElement)("td",{colSpan:"9",className:"text-center py-8"},(0,r.createElement)("div",{className:"text-gray-500"},(0,r.createElement)("svg",{className:"w-12 h-12 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,r.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})),(0,r.createElement)("p",{className:"text-lg font-medium"},(0,n.__)("No entries found","ultimate-spin-wheel")),(0,r.createElement)("p",{className:"text-sm mt-1"},(0,n.__)("No entries match your current filters","ultimate-spin-wheel"))))))))),d>1&&(0,r.createElement)("div",{className:"bg-white rounded-xl shadow-lg px-6 py-4"},(0,r.createElement)("div",{className:"flex items-center justify-between"},(0,r.createElement)("div",{className:"text-sm text-gray-700"},(0,n.__)("Showing","ultimate-spin-wheel")," ",(o-1)*g+1," ",(0,n.__)("to","ultimate-spin-wheel")," ",Math.min(o*g,p)," ",(0,n.__)("of","ultimate-spin-wheel")," ",p," ",(0,n.__)("entries","ultimate-spin-wheel")),(0,r.createElement)("div",{className:"flex items-center gap-2"},(0,r.createElement)("button",{onClick:()=>v(o-1),disabled:1===o,className:"px-3 py-1 rounded-lg border border-gray-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},(0,n.__)("Previous","ultimate-spin-wheel")),(()=>{const e=[];if(d<=5)for(let t=1;t<=d;t++)e.push(t);else{const t=Math.max(1,o-Math.floor(2.5)),a=Math.min(d,t+5-1);for(let r=t;r<=a;r++)e.push(r)}return e})().map(e=>(0,r.createElement)("button",{key:e,onClick:()=>v(e),className:"px-3 py-1 rounded-lg text-sm transition-colors "+(o===e?"bg-blue-600 text-white":"border border-gray-300 hover:bg-gray-50")},e)),(0,r.createElement)("button",{onClick:()=>v(o+1),disabled:o===d,className:"px-3 py-1 rounded-lg border border-gray-300 text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"},(0,n.__)("Next","ultimate-spin-wheel"))))))}}}]);